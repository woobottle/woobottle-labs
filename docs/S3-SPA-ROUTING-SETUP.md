# S3 웹사이트 호스팅 SPA 라우팅 설정 가이드

## 문제 상황
Next.js App Router로 개발된 SPA를 S3 정적 호스팅으로 배포할 때, 메뉴 이동 시 404 오류가 발생하는 문제가 있습니다.

## 원인 분석
1. **Next.js의 클라이언트 사이드 라우팅**: Link 컴포넌트는 JavaScript로 페이지를 전환하므로 서버 요청이 발생하지 않습니다.
2. **직접 URL 접근 시**: 사용자가 URL을 직접 입력하거나 새로고침할 때 S3에서 해당 경로의 파일을 찾지 못해 404 오류가 발생합니다.
3. **S3의 정적 호스팅 특성**: S3는 요청된 경로에 정확한 파일이 없으면 404를 반환합니다.

## 해결 방법

### 1. S3 버킷 웹사이트 호스팅 설정

AWS S3 콘솔에서 다음과 같이 설정하세요:

1. **S3 버킷 선택** → `woo-bottle.com` 버킷
2. **속성(Properties)** 탭 → **정적 웹 사이트 호스팅** 편집
3. 다음과 같이 설정:
   ```
   정적 웹 사이트 호스팅: 활성화
   호스팅 유형: 정적 웹사이트 호스팅
   인덱스 문서: index.html
   오류 문서: index.html  ← 중요!
   ```

### 2. CloudFront 배포 설정

CloudFront에서 커스텀 오류 페이지를 설정하여 404 오류를 처리합니다:

1. **CloudFront 배포 선택**
2. **오류 페이지** 탭 → **사용자 지정 오류 응답 생성**
3. 다음과 같이 설정:
   ```
   HTTP 오류 코드: 404
   오류 캐싱 최소 TTL: 10
   사용자 지정 오류 응답: 예
   응답 페이지 경로: /index.html
   HTTP 응답 코드: 200
   ```

### 3. 추가 오류 코드 처리 (선택사항)

403 오류도 함께 처리하는 것을 권장합니다:
```
HTTP 오류 코드: 403
오류 캐싱 최소 TTL: 10
사용자 지정 오류 응답: 예
응답 페이지 경로: /index.html
HTTP 응답 코드: 200
```

## 코드 변경 사항

### next.config.ts 수정
```typescript
const nextConfig = {
  output: 'export',
  trailingSlash: true,  // URL 끝에 슬래시 추가
  images: {
    unoptimized: true,  // static export에서 필요
  },
  // ... 기타 설정
};
```

### 배포 스크립트 수정
HTML 파일들이 S3에 업로드되도록 배포 스크립트를 수정했습니다:
- HTML 파일: 짧은 캐시 (5분)
- 정적 자산: 긴 캐시 (1년)
- JSON 파일: 중간 캐시 (1시간)

## 테스트 방법

1. **배포 후 테스트**:
   ```bash
   # GitHub Actions로 배포
   # 또는 로컬에서 빌드 테스트
   pnpm build
   ```

2. **브라우저에서 확인**:
   - 메뉴 클릭으로 페이지 이동 ✓
   - 직접 URL 입력 (예: `https://woo-bottle.com/text-counter/`) ✓
   - 새로고침 ✓

3. **개발자 도구 네트워크 탭**에서 404 오류가 없는지 확인

## 주의사항

1. **CloudFront 캐시 무효화**: 설정 변경 후 반드시 캐시를 무효화하세요.
2. **DNS 전파 시간**: 설정 변경 후 전 세계적으로 반영되는 데 시간이 걸릴 수 있습니다.
3. **SEO 고려사항**: 모든 404를 200으로 리다이렉트하므로 SEO에 영향을 줄 수 있습니다.

## 문제 해결

### 여전히 404가 발생하는 경우:
1. S3 버킷 정책 확인
2. CloudFront 오리진 설정 확인
3. 캐시 무효화 실행
4. 브라우저 캐시 삭제

### 성능 최적화:
- 정적 자산은 긴 캐시 시간 설정
- HTML 파일은 짧은 캐시 시간 설정
- Gzip 압축 활성화
